{{- if hasPrefix "linux-arch" .osid -}}
#!/bin/sh -e

if ! command -v paru >/dev/null; then
  echo "Bootstrapping paru..."

  PARU="${TMPDIR:-/tmp}/paru"
  trap 'rm -rf $PARU' EXIT

  git clone https://aur.archlinux.org/paru-bin.git "$PARU"
  (cd $PARU && makepkg -si --noconfirm)
fi

{{- $packages := .packages.arch.packages | sortAlpha | uniq -}}

{{- if eq .osid "linux-archarm" }}
{{/* 1password-cli, qmk and rr are unavailable on aarch64 */}}
{{    $packages = without $packages "1password-cli" "git-interactive-rebase-tool-bin" "qmk" "rr-bin" "shellcheck" }}
{{/* git-interactive-rebase-tool must be built, and shellcheck is shellcheck-bin */}}
{{    $packages = concat $packages (list "git-interactive-rebase-tool" "shellcheck-bin") }}
{{- end }}

echo "Installing packages with paru..."
paru -Sy --needed --noconfirm {{ join " " $packages }}

{{- end -}}
