#!/usr/bin/env bash

# Load global config.
if [ -d /etc/X11/xinit/xinitrc.d ] ; then
 for f in /etc/X11/xinit/xinitrc.d/?*.sh ; do
  [ -x "$f" ] && . "$f"
 done
 unset f
fi

# Load local config.
if [ -f $HOME/.xinitrc.local ]; then
  source $HOME/.xinitrc.local
fi

#
# Environment
#

# Make sure to allow tmux.
unset TMUX

#
# Background
#

# Load the background with nitrogen.
nitrogen --restore &
# Start compton (X compositor).
compton -b &
# Start devmon (userspace auto-mounter).
devmon --info-on-mount &
# Start dunst (notification daemon).
dunst -mon $(($(xrandr -q | grep '\sconnected\s' | wc -l) - 1)) &
# Start PulseAudio (sound server).
start-pulseaudio-x11 &
# Start Redshift (screen tinter).
redshift &
# Start SpaceFM daemon (file manager).
spacefm -d &
# Start unclutter (mouse hiding daemon).
unclutter &
# Start xautolock (screen locker/timer).
xautolock -locker xlock -time 5 -corners ---- &
# Start xbindkeys (keyboard mapping daemon).
xbindkeys &
# Load keymap.
xmodmap ~/.Xmodmap &


#
# Session
#

# Default to dwm.
session=${1:-dwm}

# Run dwm status daemon if we're running dwm.
if [ $session == "dwm" ]; then
  dwmstatus &
fi

case $session in
    dwm) exec dwm;;
    i3 ) exec i3;;
    *  ) exec $session;;
esac
