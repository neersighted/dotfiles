#!/bin/sh

parse_display() {
  while [ "$#" -gt 0 ]; do
    case "$1" in
      --display) echo "$2"; shift 2;;
      *        ) shift;;
    esac
  done
}

DISPLAY=$(parse_display "$@")
if [ -n "$DISPLAY" ]; then
  if command -v pinentry-qt5 >/dev/null; then
    exec pinentry-qt5 "$@"
  elif command -v pinentry-qt >/dev/null; then
    exec pinentry-qt "$@"
  elif command -v pinentry-gnome3 >/dev/null; then
    exec pinentry-gnome3 "$@"
  elif command -v pinentry-gtk-2 >/dev/null; then
    exec pinentry-gtk-2 "$@"
  fi
elif [ "$(uname)" = "Darwin" ]; then
  if command -v pinentry-mac >/dev/null; then
    exec pinentry-mac "$@"
  fi
fi

exec pinentry-curses "$@"
